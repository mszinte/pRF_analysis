"""-----------------------------------------------------------------------------------------pdf_maps.py-----------------------------------------------------------------------------------------Goal of the script:Concat all subject pycortex maps in one pdf-----------------------------------------------------------------------------------------Input(s):sys.argv[1]: main project directorysys.argv[2]: project name (correspond to directory)sys.argv[3]: number of subjectssys.argv[4]: group-----------------------------------------------------------------------------------------Output(s):pdf files with pycortex maps-----------------------------------------------------------------------------------------To run:0. To Run on meso (not on node)1. cd to function>>  cd ~/projects/[PROJECT]/analysis_code/postproc/group_analysis2. run python command>> python pdf_maps.py [main directory] [project name] [group]-----------------------------------------------------------------------------------------Exemple:cd ~/projects/RetinoMaps/analysis_code/postproc/group_analysispython pdf_maps.py /scratch/mszinte/data RetinoMaps 327-----------------------------------------------------------------------------------------Written by Martin Szinte (mail@martinszinte.net)Edited by Uriel Lascombes (uriel.lascombes@laposte.net)-----------------------------------------------------------------------------------------"""# General importsimport sysfrom pypdf import PdfMergerimport osimport json# Debugimport ipdbdeb = ipdb.set_trace# Inputsmain_dir = sys.argv[1]project_dir = sys.argv[2]group = sys.argv[3]# load settingswith open('../../settings.json') as f:    json_s = f.read()    analysis_info = json.loads(json_s)subjects = analysis_info['subjects']tasks = analysis_info['task_names']formats = analysis_info['formats']extensions = analysis_info['extensions']prf_task_name = analysis_info['prf_task_name']for format_, extension in zip(formats, extensions):    # prf maps    maps = ['ecc','polar_255','size', 'loo_rsq','n', 'pcm']    for map_ in maps :         merger_prf = PdfMerger()        for subject in subjects:            pdf_dir = '{}/{}/derivatives/pp_data/{}/{}/prf/pycortex/flatmaps_loo-avg_css'.format(                main_dir, project_dir, subject, format_)            pdf_fn = '{}_task-{}_{}_css.pdf'.format(subject, prf_task_name, map_)            merger_prf.append('{}/{}'.format(pdf_dir,pdf_fn))                    pdf_dir = "{}/{}/derivatives/pp_data/group/{}/prf/pycortex".format(            main_dir,project_dir,format_)        os.makedirs(pdf_dir, exist_ok = True)            merger_prf.write('{}/group_task-pRF_{}_css.pdf'.format(pdf_dir,map_))        merger_prf.close()    print('prf maps are done')        # # corr maps         for task in tasks:         merger_corr = PdfMerger()        for subject in subjects:            pdf_dir = '{}/{}/derivatives/pp_data/{}/{}/corr/pycortex/flatmaps_corr'.format(                main_dir, project_dir, subject, format_)            pdf_fn = '{}_task-{}_run_corr_stats.pdf'.format(subject,task)            merger_corr.append('{}/{}'.format(pdf_dir,pdf_fn))                    pdf_dir = "{}/{}/derivatives/pp_data/group/{}/corr/pycortex".format(            main_dir, project_dir, format_)        os.makedirs(pdf_dir, exist_ok = True)                merger_corr.write('{}/group_task-{}_run_corr_stats.pdf'.format(pdf_dir, task))        merger_corr.close()    print('correlations maps are done')               # glm maps        maps = ['all', 'pursuit', 'saccade', 'pursuit_and_saccade', 'vision', 'vision_and_pursuit', 'vision_and_saccade', 'vision_and_pursuit_and_saccade']    for map_ in maps :         merger_glm = PdfMerger()        for subject in subjects:            pdf_dir = '{}/{}/derivatives/pp_data/{}/{}/final_stats/pycortex/flatmaps_stats'.format(                main_dir, project_dir, subject, format_)            pdf_fn = '{}_final_{}.pdf'.format(subject,map_)            merger_glm.append('{}/{}'.format(pdf_dir,pdf_fn))                    pdf_dir = "{}/{}/derivatives/pp_data/group/{}/final_stats/pycortex".format(            main_dir,project_dir,format_)        os.makedirs(pdf_dir, exist_ok = True)        merger_glm.write('{}/group_{}.pdf'.format(pdf_dir, map_))        merger_glm.close()     print('final stats maps are done')          # rois maps        merger_rois = PdfMerger()    for subject in subjects:        pdf_dir = '{}/{}/derivatives/pp_data/{}/{}/rois/pycortex/flatmaps_rois'.format(            main_dir, project_dir, subject, format_)        pdf_fn = '{}_task-{}_rois.pdf'.format(subject,prf_task_name)        merger_rois.append('{}/{}'.format(pdf_dir,pdf_fn))            pdf_dir = "{}/{}/derivatives/pp_data/group/{}/rois/pycortex".format(        main_dir,project_dir,format_)    os.makedirs(pdf_dir, exist_ok = True)    merger_rois.write('{}/group_rois.pdf'.format(pdf_dir))    merger_rois.close()    print('rois maps are done')     # Define permission cmdprint('Changing files permissions in {}/{}'.format(main_dir, project_dir))os.system("chmod -Rf 771 {main_dir}/{project_dir}".format(main_dir=main_dir, project_dir=project_dir))os.system("chgrp -Rf {group} {main_dir}/{project_dir}".format(main_dir=main_dir, project_dir=project_dir, group=group))